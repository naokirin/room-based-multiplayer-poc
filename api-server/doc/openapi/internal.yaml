---
openapi: 3.0.3
info:
  title: Room-Based Multiplayer Platform â€” Internal API
  version: v1
servers:
- url: http://localhost:3001
paths:
  "/internal/auth/verify":
    post:
      summary: verify
      tags:
      - Internal::Auth
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                token:
                  type: string
              required:
              - token
            example:
              token: eyJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiM2NlOTc3NjEtODFhMS00Njc0LTk3YWUtMmFmZDM0NTNlODc5IiwiZXhwIjoxNzcxNTA3MTk1LCJpYXQiOjE3NzE1MTA3OTV9.byRyBjLym558MOO3HB0opBeKq3DTn-3jF7xSnuJ4SAw
      responses:
        '200':
          description: returns invalid for expired token
          content:
            application/json:
              schema:
                type: object
                properties:
                  valid:
                    type: boolean
                  user_id:
                    type: string
                  display_name:
                    type: string
                  role:
                    type: string
                  status:
                    type: string
                  reason:
                    type: string
                required:
                - valid
              example:
                valid: false
                user_id: 88a668c7-8803-4b94-b38a-cfd790ad47b7
                display_name: TestUser
                role: player
                status: active
                reason: invalid_token
        '401':
          description: returns 401 without api key
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
              example:
                error: unauthorized
  "/internal/rooms":
    post:
      summary: create
      tags:
      - Internal::Room
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                room_id:
                  type: string
                node_name:
                  type: string
              required:
              - room_id
              - node_name
            example:
              room_id: 676e24b0-2091-4e7f-865a-74a18bdafb30
              node_name: game-node-1
      responses:
        '200':
          description: updates room status to ready
          content:
            application/json:
              schema:
                type: object
                properties:
                  acknowledged:
                    type: boolean
                  room_id:
                    type: string
                  room_status:
                    type: string
                required:
                - acknowledged
                - room_id
                - room_status
              example:
                acknowledged: true
                room_id: 676e24b0-2091-4e7f-865a-74a18bdafb30
                room_status: ready
        '401':
          description: returns 401 error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
              example:
                error: unauthorized
        '404':
          description: returns 404 error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                - error
                - message
              example:
                error: room_not_found
                message: Room not found
  "/internal/rooms/{room_id}/aborted":
    put:
      summary: aborted
      tags:
      - Internal::Room
      parameters:
      - name: room_id
        in: path
        required: true
        schema:
          oneOf:
          - type: string
          - type: integer
        example: 5f43aeef-37ea-4a7c-a09e-bf519df84f1f
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties: {}
            example: {}
      responses:
        '200':
          description: marks room as aborted
          content:
            application/json:
              schema:
                type: object
                properties:
                  acknowledged:
                    type: boolean
                  room_status:
                    type: string
                required:
                - acknowledged
                - room_status
              example:
                acknowledged: true
                room_status: aborted
        '401':
          description: returns 401 error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
              example:
                error: unauthorized
        '404':
          description: returns 404 error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
              example:
                error: not_found
  "/internal/rooms/{room_id}/finished":
    put:
      summary: finished
      tags:
      - Internal::Room
      parameters:
      - name: room_id
        in: path
        required: true
        schema:
          oneOf:
          - type: string
          - type: integer
        example: 49b69727-e71d-4e6e-992f-24c5fcedfd61
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                winner_id:
                  type: string
                turns_played:
                  type: integer
                duration_seconds:
                  type: integer
                player_results:
                  type: object
                  properties:
                    94b8e06f-e02e-4763-a99b-c2b9daa511b6:
                      type: string
                    e5abe5bf-752c-4af6-b32a-6b3926aff746:
                      type: string
                    e4274dcd-543b-4e6c-aff2-cea4b432587c:
                      type: string
                    6e7059ad-7f77-44d2-8b90-aae4dfc7ced0:
                      type: string
                    4196802c-1330-4851-a605-6be2935e1254:
                      type: string
                    ffe48860-6de7-42d6-bb67-df8318b03fdb:
                      type: string
                  required:
                  - 4196802c-1330-4851-a605-6be2935e1254
                  - ffe48860-6de7-42d6-bb67-df8318b03fdb
              required:
              - winner_id
              - turns_played
              - duration_seconds
              - player_results
            example:
              winner_id: 4196802c-1330-4851-a605-6be2935e1254
              turns_played: 10
              duration_seconds: 300
              player_results:
                94b8e06f-e02e-4763-a99b-c2b9daa511b6: winner
                e5abe5bf-752c-4af6-b32a-6b3926aff746: loser
                e4274dcd-543b-4e6c-aff2-cea4b432587c: winner
                6e7059ad-7f77-44d2-8b90-aae4dfc7ced0: loser
                4196802c-1330-4851-a605-6be2935e1254: winner
                ffe48860-6de7-42d6-bb67-df8318b03fdb: loser
      responses:
        '200':
          description: creates game result and updates players
          content:
            application/json:
              schema:
                type: object
                properties:
                  acknowledged:
                    type: boolean
                  game_result_id:
                    type: string
                required:
                - acknowledged
                - game_result_id
              example:
                acknowledged: true
                game_result_id: ed30f438-a3e9-4af6-b73d-374fffde1380
        '401':
          description: returns 401 error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
              example:
                error: unauthorized
        '404':
          description: returns 404 error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
              example:
                error: not_found
  "/internal/rooms/{room_id}/started":
    put:
      summary: started
      tags:
      - Internal::Room
      parameters:
      - name: room_id
        in: path
        required: true
        schema:
          oneOf:
          - type: string
          - type: integer
        example: ae84ab8c-ab80-44e1-82fb-6fbaa6e5036c
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                player_ids:
                  type: array
                  items:
                    type: string
              required:
              - player_ids
            example:
              player_ids:
              - 9600a2ed-0844-44aa-8d4d-03424f3e1dac
              - 19fdf530-d981-4aec-997b-e1f2cc788577
      responses:
        '200':
          description: accepts players in any order
          content:
            application/json:
              schema:
                type: object
                properties:
                  acknowledged:
                    type: boolean
                  room_status:
                    type: string
                required:
                - acknowledged
                - room_status
              example:
                acknowledged: true
                room_status: playing
        '400':
          description: returns 400 error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                  expected:
                    type: array
                    items:
                      type: string
                  provided:
                    type: array
                    items:
                      type: string
                required:
                - error
                - message
                - expected
                - provided
              example:
                error: player_mismatch
                message: Provided player_ids do not match room players
                expected:
                - 6d5b6f9c-d792-49f1-92a9-a7438b714c98
                - ac55daee-e92b-48c1-95be-d3d5e570ac21
                provided:
                - 79edae2b-29eb-4b1c-82f3-6ac8b2b4b59c
                - ac55daee-e92b-48c1-95be-d3d5e570ac21
        '401':
          description: returns 401 error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
              example:
                error: unauthorized
        '404':
          description: returns 404 error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                required:
                - error
              example:
                error: not_found
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    apiKeyAuth:
      type: apiKey
      in: header
      name: X-Internal-Api-Key
security:
- apiKeyAuth: []
