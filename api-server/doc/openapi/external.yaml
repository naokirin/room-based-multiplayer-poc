---
openapi: 3.0.3
info:
  title: Room-Based Multiplayer Platform â€” External API
  version: v1
servers:
- url: http://localhost:3001
paths:
  "/api/v1/announcements":
    get:
      summary: index
      tags:
      - Api::V1::Announcement
      responses:
        '200':
          description: returns empty array when no visible announcements
          content:
            application/json:
              schema:
                type: object
                properties:
                  announcements:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        title:
                          type: string
                        body:
                          type: string
                        published_at:
                          type: string
                      required:
                      - id
                      - title
                      - body
                      - published_at
                required:
                - announcements
              example:
                announcements: []
  "/api/v1/auth/login":
    post:
      summary: login
      tags:
      - Api::V1::Auth
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                password:
                  type: string
              required:
              - email
              - password
            example:
              email: test@example.com
              password: password123
      responses:
        '200':
          description: creates audit log with UUID and allows repeated logins without
            duplicate key error
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    type: object
                    properties:
                      id:
                        type: string
                      email:
                        type: string
                      display_name:
                        type: string
                      role:
                        type: string
                      status:
                        type: string
                    required:
                    - id
                    - email
                    - display_name
                    - role
                    - status
                  access_token:
                    type: string
                  expires_at:
                    type: string
                required:
                - user
                - access_token
                - expires_at
              example:
                user:
                  id: 7073d638-e606-4148-a735-8821ded51a19
                  email: test@example.com
                  display_name: TestUser
                  role: player
                  status: active
                access_token: eyJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiNzA3M2Q2MzgtZTYwNi00MTQ4LWE3MzUtODgyMWRlZDUxYTE5IiwiZXhwIjoxNzcxNTE0Mzk0LCJpYXQiOjE3NzE1MTA3OTR9.YAgdgUKMYfVxbBpvM6BgsNJ0wLBYpKFi7-G_9Y3GJSI
                expires_at: '2026-02-19T15:19:54Z'
        '401':
          description: returns 401 for frozen account
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                - error
                - message
              example:
                error: account_frozen
                message: Your account has been suspended
  "/api/v1/auth/refresh":
    post:
      summary: refresh
      tags:
      - Api::V1::Auth
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties: {}
            example: {}
      responses:
        '200':
          description: returns a new token
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string
                  expires_at:
                    type: string
                required:
                - access_token
                - expires_at
              example:
                access_token: eyJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiZDJjYTYxNWYtM2FhNS00NjZmLTlmNzItZmVmNGRkYzNkZThkIiwiZXhwIjoxNzcxNTE0Mzk0LCJpYXQiOjE3NzE1MTA3OTR9.aDE-BWfBFwgqqfh-z1oZ_U5dtHLruu26RErkorsjfsY
                expires_at: '2026-02-19T15:19:54Z'
        '401':
          description: returns 401 without token
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                - error
                - message
              example:
                error: unauthorized
                message: Invalid or expired token
  "/api/v1/auth/register":
    post:
      summary: register
      tags:
      - Api::V1::Auth
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  type: object
                  properties:
                    email:
                      type: string
                    password:
                      type: string
                    display_name:
                      type: string
                  required:
                  - email
                  - password
                  - display_name
              required:
              - user
            example:
              user:
                email: new@example.com
                password: password123
                display_name: NewUser
      responses:
        '201':
          description: creates a new user and returns token
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    type: object
                    properties:
                      id:
                        type: string
                      email:
                        type: string
                      display_name:
                        type: string
                    required:
                    - id
                    - email
                    - display_name
                  access_token:
                    type: string
                  expires_at:
                    type: string
                required:
                - user
                - access_token
                - expires_at
              example:
                user:
                  id: f0cfd199-e43a-4664-b87b-2aae6fa7b35b
                  email: new@example.com
                  display_name: NewUser
                access_token: eyJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiZjBjZmQxOTktZTQzYS00NjY0LWI4N2ItMmFhZTZmYTdiMzViIiwiZXhwIjoxNzcxNTE0Mzk0LCJpYXQiOjE3NzE1MTA3OTR9.pQBa-dfDeAyh2BzMB0mEnuM-Fum_-zMYbkvGLSj0FlM
                expires_at: '2026-02-19T15:19:54Z'
        '422':
          description: returns 422 for short password
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: object
                    properties:
                      email:
                        type: array
                        items:
                          type: string
                      password:
                        type: array
                        items:
                          type: string
                required:
                - errors
              example:
                errors:
                  email:
                  - has already been taken
                  password:
                  - is too short (minimum is 8 characters)
  "/api/v1/game_types":
    get:
      summary: index
      tags:
      - Api::V1::GameType
      responses:
        '200':
          description: returns empty array when no game types
          content:
            application/json:
              schema:
                type: object
                properties:
                  game_types:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        name:
                          type: string
                        player_count:
                          type: integer
                        turn_time_limit:
                          type: integer
                      required:
                      - id
                      - name
                      - player_count
                      - turn_time_limit
                required:
                - game_types
              example:
                game_types: []
  "/api/v1/health":
    get:
      summary: show
      tags:
      - Api::V1::Health
      responses:
        '200':
          description: returns ok and expected response format (status, services)
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  services:
                    type: object
                    properties:
                      database:
                        type: string
                      redis:
                        type: string
                    required:
                    - database
                    - redis
                required:
                - status
                - services
              example:
                status: ok
                services:
                  database: ok
                  redis: ok
  "/api/v1/matchmaking/cancel":
    delete:
      summary: cancel
      tags:
      - Api::V1::Matchmaking
      responses:
        '200':
          description: returns ok with cancelled status (idempotent)
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  user_id:
                    type: string
                required:
                - status
                - user_id
              example:
                status: cancelled
                user_id: bb396660-21f6-4308-a4da-39309389c990
        '401':
          description: returns 401 without token
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                - error
                - message
              example:
                error: unauthorized
                message: Invalid or expired token
  "/api/v1/matchmaking/join":
    post:
      summary: join
      tags:
      - Api::V1::Matchmaking
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                game_type_id:
                  type: string
              required:
              - game_type_id
            example:
              game_type_id: 194c268b-2866-4488-b289-032d189e3cdc
      responses:
        '200':
          description: clears stale Redis and allows join (returns queued)
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  game_type_id:
                    type: string
                  queued_at:
                    type: string
                  timeout_seconds:
                    type: integer
                  room_id:
                    type: string
                  room_token:
                    type: string
                  ws_url:
                    type: string
                required:
                - status
              example:
                status: queued
                game_type_id: 194c268b-2866-4488-b289-032d189e3cdc
                queued_at: '2026-02-19T14:19:54Z'
                timeout_seconds: 60
                room_id: be9269b7-5cc0-47d2-8d5d-40c935ec68a3
                room_token: eyJhbGciOiJIUzI1NiJ9.eyJyb29tX2lkIjoiYmU5MjY5YjctNWNjMC00N2QyLThkNWQtNDBjOTM1ZWM2OGEzIiwidXNlcl9pZCI6IjlkNGJiMzg4LTE5YzEtNGFmNy05MDlkLTY4Mzc4MDQ3YmM2OCIsInR5cGUiOiJyb29tX3Rva2VuIiwiZXhwIjoxNzcxNTExMDk0LCJpYXQiOjE3NzE1MTA3OTR9.dZuamrruR8TkZy4AjWk-K7uGlcV9F4rnl4puePbJ5Tw
                ws_url: ws://localhost:4000/socket
        '401':
          description: returns 401 without token
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                - error
                - message
              example:
                error: unauthorized
                message: Invalid or expired token
        '404':
          description: returns not_found error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                - error
                - message
              example:
                error: invalid_game_type
                message: Game type not found or inactive
        '409':
          description: returns already_in_game status
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  queued_at:
                    type: string
                  room_id:
                    type: string
                  room_token:
                    type: string
                  ws_url:
                    type: string
                required:
                - status
              example:
                status: already_in_game
                queued_at: '2026-02-19T14:19:54Z'
                room_id: 7865f7b4-bb46-4850-b110-933c9408f20b
                room_token: test-token
                ws_url: ws://localhost:4000/socket
  "/api/v1/matchmaking/status":
    get:
      summary: status
      tags:
      - Api::V1::Matchmaking
      responses:
        '200':
          description: returns timeout status and cleans up
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  queued_at:
                    type: string
                  game_type_id:
                    type: string
                  room_id:
                    type: string
                  room_token:
                    type: string
                  ws_url:
                    type: string
                  message:
                    type: string
                required:
                - status
              example:
                status: timeout
                queued_at: '2026-02-19T14:19:55Z'
                game_type_id: 8cb3f39c-b3fd-4492-80d2-be2c4c55bf83
                room_id: aebffb58-0be4-49fd-b7cb-30ea2e57839a
                room_token: test-token
                ws_url: ws://localhost:4000/socket
                message: Matchmaking timeout
        '401':
          description: returns 401 without token
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                - error
                - message
              example:
                error: unauthorized
                message: Invalid or expired token
  "/api/v1/profile":
    get:
      summary: show
      tags:
      - Api::V1::Profile
      responses:
        '200':
          description: returns current user profile
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    type: object
                    properties:
                      id:
                        type: string
                      email:
                        type: string
                      display_name:
                        type: string
                      role:
                        type: string
                      status:
                        type: string
                      created_at:
                        type: string
                    required:
                    - id
                    - email
                    - display_name
                    - role
                    - status
                    - created_at
                required:
                - user
              example:
                user:
                  id: e8268163-5c24-409e-8f29-cf6bc272cdd2
                  email: user10@example.com
                  display_name: TestUser
                  role: player
                  status: active
                  created_at: '2026-02-19T14:19:54Z'
  "/api/v1/rooms/{id}/ws_endpoint":
    get:
      summary: ws_endpoint
      tags:
      - Api::V1::Room
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
        example: 61c83b0e-59b4-4ec5-aab0-14dd71d13ada
      responses:
        '200':
          description: returns ok and expected response format (ws_url, node_name,
            room_status)
          content:
            application/json:
              schema:
                type: object
                properties:
                  ws_url:
                    type: string
                  node_name:
                    type: string
                  room_status:
                    type: string
                required:
                - ws_url
                - node_name
                - room_status
              example:
                ws_url: ws://localhost:4000/socket
                node_name: game-node-1
                room_status: ready
        '401':
          description: returns 401 without token
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                - error
                - message
              example:
                error: unauthorized
                message: Invalid or expired token
        '404':
          description: returns 404 with error format
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
                required:
                - error
                - message
              example:
                error: room_not_found
                message: Room with ID 00000000-0000-0000-0000-000000000000 not found
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    apiKeyAuth:
      type: apiKey
      in: header
      name: X-Internal-Api-Key
security:
- bearerAuth: []
