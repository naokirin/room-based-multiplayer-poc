# Implementation Plan: OpenAPI Support (Internal/External API Split)

**Branch**: `003-openapi-api-split` | **Date**: 2026-02-19 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/003-openapi-api-split/spec.md`

## Summary

Add OpenAPI 3.0 definition file generation to the api-server using the `rspec-openapi` gem. Existing RSpec request specs are used as the source of truth to auto-generate two separate OpenAPI YAML files: one for the external API (`/api/v1/`) and one for the internal API (`/internal/`). Definition files are committed to the repository and regenerated by running the test suite.

## Technical Context

**Language/Version**: Ruby 3.3+, Rails 8.0+
**Primary Dependencies**: rspec-openapi gem (generates OpenAPI from RSpec request specs)
**Storage**: N/A (generates static YAML files)
**Testing**: RSpec (existing request specs drive OpenAPI generation)
**Target Platform**: Linux server / macOS development
**Project Type**: Web application (api-server component of monorepo)
**Performance Goals**: N/A (build-time artifact generation)
**Constraints**: Must not alter existing API behavior or test assertions
**Scale/Scope**: 11 external + 5 internal API endpoints

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Server-Authoritative | PASS | No game logic changes; documentation only |
| II. Platform-First, Game-Agnostic | PASS | No game-specific code introduced |
| III. Clear Service Boundaries | PASS | Changes confined to api-server; internal/external split reinforces boundaries |
| IV. Test-First for Contracts | PASS | OpenAPI specs are generated FROM existing tests; strengthens contract documentation |
| V. Simplicity and MVP Discipline | PASS | rspec-openapi is the lightest approach — leverages existing tests with minimal config |

**Gate result**: ALL PASS — proceed to Phase 0.

## Project Structure

### Documentation (this feature)

```text
specs/003-openapi-api-split/
├── plan.md              # This file
├── research.md          # Phase 0 output
├── data-model.md        # Phase 1 output
├── quickstart.md        # Phase 1 output
├── contracts/           # Phase 1 output
└── tasks.md             # Phase 2 output (/speckit.tasks)
```

### Source Code (repository root)

```text
api-server/
├── Gemfile                              # Add rspec-openapi gem
├── spec/
│   ├── openapi_helper.rb                # NEW: rspec-openapi configuration
│   ├── rails_helper.rb                  # Require openapi_helper
│   └── requests/
│       ├── api/v1/                      # Existing external API specs (drive generation)
│       │   ├── auth_spec.rb
│       │   ├── matchmaking_spec.rb
│       │   ├── game_types_spec.rb
│       │   ├── health_spec.rb
│       │   ├── announcements_spec.rb
│       │   └── rooms_spec.rb
│       └── internal/                    # Existing internal API specs (drive generation)
│           ├── auth_spec.rb
│           └── rooms_spec.rb
└── doc/
    └── openapi/
        ├── external.yaml                # GENERATED: External API OpenAPI 3.0 definition
        └── internal.yaml                # GENERATED: Internal API OpenAPI 3.0 definition
```

**Structure Decision**: Generated OpenAPI files go under `api-server/doc/openapi/` to follow Rails convention (`doc/` directory). Two separate files ensure clean internal/external separation per FR-003.

## Complexity Tracking

No violations — simplest viable approach selected. Single gem addition with configuration only.
